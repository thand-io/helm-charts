# Default values for Thand Agent
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Namespace where the agent will be deployed
namespaceOverride: ""

# Hostname for external access
hostname: "thand-agent.local"
loginEndpoint: "http://{{ .Values.hostname }}"

# Number of replicas for the deployment
replicaCount: 1

# Container image configuration
image:
  repository: ghcr.io/thand-io/agent
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion
  tag: ""

# Image pull secrets for private registries
imagePullSecrets: []

# Override chart name
nameOverride: ""
fullnameOverride: ""

# Service account configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# RBAC configuration
rbac:
  # Specifies whether RBAC resources should be created
  create: true
  # Rules for the ClusterRole
  rules:
    # RBAC permissions for managing roles and bindings
    - apiGroups: ["rbac.authorization.k8s.io"]
      resources: ["roles", "rolebindings", "clusterroles", "clusterrolebindings"]
      verbs: ["get", "list", "create", "update", "patch", "delete"]
    # Namespace access
    - apiGroups: [""]
      resources: ["namespaces"]
      verbs: ["get", "list"]
    # Service account access (for user validation)
    - apiGroups: [""]
      resources: ["serviceaccounts"]
      verbs: ["get", "list"]

# Pod annotations
podAnnotations: {}

# Pod labels
podLabels: {}

# Pod security context
podSecurityContext: {}
  # fsGroup: 2000

# Container security context
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# Service configuration
service:
  type: ClusterIP
  port: 8080
  targetPort: http
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: "{{ .Values.hostname }}"
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: thand-agent-tls
  #    hosts:
  #      - "{{ .Values.hostname }}"

# HTTPRoute configuration (Gateway API)
httpRoute:
  enabled: false
  annotations: {}
  parentRefs:
    - name: gateway
      sectionName: http
  hostnames:
    - "{{ .Values.hostname }}"
  rules:
    - matches:
      - path:
          type: PathPrefix
          value: /

# Resource limits and requests
resources:
  requests:
    memory: "1Gi"
    cpu: "500m"
  limits:
    memory: "4Gi"
    cpu: "1000m"

# Liveness probe configuration
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

# Readiness probe configuration
readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  successThreshold: 1
  failureThreshold: 3

# Autoscaling configuration
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity rules
affinity: {}

# Environment variables
env:
  # Log level: debug, info, warn, error
  - name: THAND_LOGIN_ENDPOINT
    value: "http://{{ .Values.hostname }}"
  - name: THAND_LOG_LEVEL
    value: "info"
  # Server port
  - name: THAND_SERVER_PORT
    value: "8080"
  # Paths for configuration
  - name: THAND_ROLES_PATH
    value: "/app/config/roles/"
  - name: THAND_PROVIDERS_PATH
    value: "/app/config/providers/"
  - name: THAND_WORKFLOWS_PATH
    value: "/app/config/workflows/"

# Additional environment variables from secrets or configmaps
envFrom: []
# - secretRef:
#     name: thand-secrets
# - configMapRef:
#     name: thand-config

# Application secrets configuration
# Used for storing sensitive data like API keys, tokens, etc.
secrets:
  # If true, creates a secret with the specified data
  enabled: true
  # Mount existing secret instead of creating one
  existingSecret: ""
  # Auto-generate secrets on deployment
  generate:
    # Enable automatic secret generation
    enabled: true
    # Length of generated secrets
    length: 32
    # List of secret keys to auto-generate if not provided in data
    keys:
      - "THAND_SECRET"
  # Secret data - will be base64 encoded automatically
  # If a key is listed in generate.keys and not provided here, it will be auto-generated
  data: {}
    # THAND_SECRET: "your-secret-value-here"  # If provided, this overrides auto-generation
    # THAND_API_KEY: "your-api-key-here"  # For Thand Cloud access

# Thand Agent Configuration
config:
  # Main configuration for the agent
  # This will be mounted as config.yaml

  login:
    endpoint: "http://{{ .Values.hostname }}"
    base: "/"

  server:
    port: 8080
    host: "0.0.0.0"
    health:
      enabled: true
      path: "/health"
    ready:
      enabled: true
      path: "/ready"
    metrics:
      enabled: true
      path: "/metrics"
  
  logging:
    level: "info"
    format: "json"
    output: "stdout"
  
  services:
    # Optional Temporal configuration
    # When temporal.enabled=true, these values are automatically populated:
    # temporal:
    #   host: temporal-frontend.<namespace>.svc.cluster.local
    #   port: 7233  
    #   namespace: default
    # 
    # Override these for external Temporal services:
    # temporal:
    #   host: "us-central1.gcp.api.temporal.io"
    #   port: 7233
    #   namespace: "my-temporal-namespace"
    #   mtls_pem: "" # Path to mTLS PEM file if required
    #   api_key: "" # Temporal API Key for Temporal Cloud
  
  providers:
    # path: /app/config/providers/
    # Provide a default Kubernetes provider
    kubernetes-cluster:
      description: Current Kubernetes cluster
      provider: kubernetes
      config: {}
      enabled: true
  
  # Roles configuration - loaded from secrets
  roles:
    path: /app/config/roles/
  
  # Workflows configuration - loaded from secrets
  workflows:
    path: /app/config/workflows/
  
  # Additional configuration can be added here
  # and will be merged into the config.yaml

# Roles secrets configuration
# Create secrets from files in your repository or provide inline
roles:
  # If true, creates a secret from the files specified
  enabled: true
  # Mount existing secret instead of creating one
  existingSecret: ""
  # Inline role definitions (will be created as secret)
  files: {}
    # all.yaml: |
    #   version: "1.0"
    #   roles:
    #     see: https://docs.thand.io/configuration/roles/

# Providers secrets configuration
# Create secrets from files in your repository or provide inline
providers:
  # If true, creates a secret from the files specified
  enabled: true
  # Mount existing secret instead of creating one
  existingSecret: ""
  # Inline provider definitions (will be created as secret)
  files: {}
    # all.yaml: |
    #   version: "1.0"
    #   providers:
    #     see: https://docs.thand.io/configuration/providers/

# Workflows secrets configuration
# Create secrets from files in your repository or provide inline
workflows:
  # If true, creates a secret from the files specified
  enabled: true
  # Mount existing secret instead of creating one
  existingSecret: ""
  # Inline workflow definitions (will be created as secret)
  files: {}
    # all.yaml: |
    #   version: "1.0"
    #   workflows:
    #     see: https://docs.thand.io/configuration/workflows/

# Additional volumes
volumes: []
# - name: custom-config

# Temporal dependency configuration
# Set enabled: true to install Temporal as a dependency
# When enabled, config.services.temporal will be automatically populated with:
# - host: temporal-frontend.<namespace>.svc.cluster.local
# - port: 7233
# - namespace: default
temporal:
  enabled: false
  # Temporal chart values can be overridden here when enabled: true
  # server:
  #   replicaCount: 1
  # cassandra:
  #   enabled: true
  # elasticsearch:
  #   enabled: false
#   configMap:
#     name: my-config

# Additional volume mounts
volumeMounts: []
# - name: custom-config
#   mountPath: /custom
#   readOnly: true

